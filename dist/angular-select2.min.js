angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).filter("groupByForSelect2",["$parse",function(a){return function(b,c,d,e){if(!angular.isObject(b)||angular.isUndefined(c))return b;var f,g,h=a(c),i=a(e),j={},k=[];return angular.forEach(b,function(a){f=h(a),g=i(a),j[f]||(j[f]={text:f,obj:g,children:[]});var b={id:a.id,text:a[d],obj:a};j[f].children.push(b)}),angular.forEach(j,function(a){k.push(a)}),k}}]).directive("select2",["$rootScope","$timeout","$parse","$filter","select2Config","select2Stack",function(a,b,c,d,e,f){"use strict";function g(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var h=d("filter"),i={},j=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e&&angular.extend(i,e),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden"></input>',replace:!0,link:function(a,d,e,k){function l(b){if(r){var c=r(a);if(c)return h(b,c)}return b}function m(a){n(q?function(b){var c=[],d=k.$viewValue||[];angular.forEach(d,function(a){for(var d=0;d<b.length;d++){var e=b[d];if(e.children)for(var f=0;f<e.children.length;f++){var g=e.children[f];(a.id===g.id||a===g.id||a.value===g.id)&&c.push(g)}else(a.id===e.id||a===e.id||a.value===e.id)&&c.push(e)}}),a(c)}:function(){var b={},c=k.$viewValue||{};angular.forEach(s,function(a){(a.obj===c||a.id===c)&&(b=a)}),a(b)})}var n,o=""===e.byid,p=angular.extend({},i,a.$eval(e.options)),q=angular.isDefined(e.multiple)||p.multiple;p.multiple=q,e.placeholder&&(p.placeholder=e.placeholder);var r=c(e.optionsFilter),s={};if(e.ngOptions){var t;if(!(t=e.ngOptions.match(j)))throw new Error("Invalid ngOptions encountered!");var u=c(t[2]||t[1]),v=c(t[7]),w=t[4]||t[6],x=c(t[2]?t[1]:w),y=t[5];n=function(b){s={};for(var c=l(v(a)),d=(y?g(c):c)||[],e=[],f=0;f<d.length;f++){var h={},i=f;y&&(i=d[f],h[y]=i),h[w]=c[i];var j=x(a,h),k=u(a,h)||"";s[j]={id:j,text:k,obj:c[i]},e.push(s[j])}b(e)},p.query=function(b){for(var c=l(v(a)),d=(y?g(c):c)||[],e=[],f=0;f<d.length;f++){var h={},i=f;y&&(i=d[f],h[y]=i),h[w]=c[i];var j=x(a,h),k=u(a,h)||"";k.toLowerCase().indexOf(b.term.toLowerCase())>-1&&(s[j]={id:j,text:k,obj:c[i]}),e.push(s[j])}b.callback({results:e})},a.$watch(t[7],function(){k.$render()})}else{if(!p.query)throw new Error("You need to supply a query function!");var z=p.query;p.query=function(a){var b=a.callback;a.callback=function(c){for(var d=[],e=0;e<c.results.length;e++){var f=c.results[e];if(f.children){var g=angular.copy(f);g.children=[];for(var h=0;h<f.children.length;h++){var i=f.children[h];i.text.toLowerCase().indexOf(a.term.toLowerCase())>-1&&(s[i.id]=i,s[i.id].obj=i.obj,g.children.push(i))}g.children.length>0&&d.push(g)}else f.text.toLowerCase().indexOf(a.term.toLowerCase())>-1&&d.push(f),s[f.id]=f}c.results=d,b(c)},z(a)},n=function(a){p.query({term:"",callback:function(b){a(b.results)}})}}if(k.$render=function(){m(function(a){var b;b=q?d.select2("data",a):d.select2("val",a.id);var c=b.select2("container").find(".select2-focusser"),e=b.select2("container").find(".select2-input");d.attr("required")&&(a.length>0||a.id?c.length?c.removeAttr("required"):e.removeAttr("required"):c.length?c.attr("required",""):e.attr("required",""))})},p.initSelection){var A=p.initSelection;p.initSelection=function(a,b){A(a,function(a){s[a.id]=a,b(a)})}}else p.initSelection=function(a,b){m(b)};var B={close:function(){d.select2("close")}};f.$register(B),a.$on("destroy",function(){f.$unregister(B)}),b(function(){var b=d.select2(p),c=b.select2("container").find(".select2-focusser"),e=b.select2("container").find(".select2-input");d.attr("required")&&c.length?c.attr("required",""):e.attr("required",""),d.on("change",function(b){a.$apply(function(){var a;if(q){for(var f=[],g=0;g<b.val.length;g++)a=s[b.val[g]],a&&f.push(o?a.id:a.obj);k.$setViewValue(f)}else a=s[b.val],k.$setViewValue(o?a?a.id:null:a?a.obj:null);d.attr("required")&&(b.val.length>0?c.length?c.removeAttr("required"):e.removeAttr("required"):c.length?c.attr("required",""):e.attr("required","")),k.$render()})}),d.on("select2-blur",function(){k.$touched||a.$apply(k.$setTouched)}),k.$render()})}}}]);